<div class="container">

  <div>Your chosen options
    : {{chosenVerb}} {{chosenSubject}} {{chosenGenres | json}} {{topSize}} {{chosenDate | json}}
    {{votersCount|json}} {{count|json}}</div>

  <br>
  <div class="tree-container">
    <!-- Verb -->
    <mat-tree [dataSource]="dataSource" [treeControl]="customTreeControl" class="tree">

      <mat-tree-node matTreeNodeToggle *matTreeNodeDef="let node">
        <li class="mat-tree-node">
          <!-- use a disabled button to provide padding for tree leaf -->
          <button mat-icon-button disabled></button>
          <mat-radio-button class="radio-button" (click)="click(node)" name="verb">
            {{node.name}}
          </mat-radio-button>
        </li>
      </mat-tree-node>

      <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild">
        <li>
          <div class="mat-tree-node">
            <button mat-icon-button matTreeNodeToggle
                    [attr.aria-label]="'toggle ' + node.name">
              <mat-icon class="mat-icon-rtl-mirror">
                {{customTreeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
              </mat-icon>
            </button>
            {{node.name}}
          </div>
          <ul [class.invisible]="!customTreeControl.isExpanded(node)">
            <ng-container matTreeNodeOutlet></ng-container>
          </ul>
        </li>
      </mat-nested-tree-node>

    </mat-tree>

    <!-- Subject -->
    <mat-tree [dataSource]="subjectDataSource" [treeControl]="treeControl" class="tree" *ngIf="achievementReq.verb">

      <mat-tree-node matTreeNodeToggle *matTreeNodeDef="let node"
                     [class.invisible]="!isSubjectAvailable(node.name)">
        <li class="mat-tree-node">
          <!-- use a disabled button to provide padding for tree leaf -->
          <button mat-icon-button disabled></button>
          <mat-radio-button class="radio-button" (click)="chooseSubject(node.name)" name="subject">
            {{node.name}}
          </mat-radio-button>
        </li>
      </mat-tree-node>

      <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild">
        <li>
          <div class="mat-tree-node">
            <button mat-icon-button matTreeNodeToggle
                    [attr.aria-label]="'toggle ' + node.name">
              <mat-icon class="mat-icon-rtl-mirror">
                {{treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
              </mat-icon>
            </button>
            {{node.name}}
          </div>
          <ul [class.invisible]="!treeControl.isExpanded(node)">
            <ng-container matTreeNodeOutlet></ng-container>
          </ul>
        </li>
      </mat-nested-tree-node>

    </mat-tree>

    <!-- Reserved book params -->
    <mat-tree [dataSource]="reservedDataSource" [treeControl]="treeControl" class="tree"
              *ngIf="chosenSubject === 'books'">
      <mat-tree-node matTreeNodeToggle *matTreeNodeDef="let node">
        <li class="mat-tree-node">
          <!-- use a disabled button to provide padding for tree leaf -->
          <button mat-icon-button disabled></button>
          <div style="display: flex;flex-direction: row;justify-content: center;align-items: center">
            <mat-checkbox class="mat-checkbox" (click)="addReservedParam(node, topSize)" name="reservedParams">
              {{node.name}}
            </mat-checkbox>
            <mat-form-field style="margin-left: 20px;width: 150px;">
              <mat-label>Select top size</mat-label>
              <mat-select [(value)]="topSize">
                <mat-option>None</mat-option>
                <mat-option value="10">10</mat-option>
                <mat-option value="20">20</mat-option>
                <mat-option value="50">50</mat-option>
                <mat-option value="100">100</mat-option>
                <mat-option value="all">all</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </li>
      </mat-tree-node>

      <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild">
        <li>
          <div class="mat-tree-node">
            <button mat-icon-button matTreeNodeToggle
                    [attr.aria-label]="'toggle ' + node.name">
              <mat-icon class="mat-icon-rtl-mirror">
                {{treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
              </mat-icon>
            </button>
            {{node.name}}
          </div>
          <ul [class.invisible]="!treeControl.isExpanded(node)">
            <ng-container matTreeNodeOutlet></ng-container>
          </ul>
        </li>
      </mat-nested-tree-node>

    </mat-tree>

  </div>

  <div>
    <label>
      Count
      <br>
      <mat-form-field>
        <input matInput placeholder="e.g. '10'" type="number" [(ngModel)]="this.achievementReq.count" name="count">
      </mat-form-field>
      <br>
    </label>
  </div>

  Count
  <mat-tree [dataSource]="countDataSource" [treeControl]="customTreeControl" class="tree">
    <mat-tree-node matTreeNodeToggle *matTreeNodeDef="let node">
      <li class="mat-tree-node">
        <!-- use a disabled button to provide padding for tree leaf -->
        <button mat-icon-button disabled></button>
        <div style="display: flex;flex-direction: row;justify-content: center;align-items: center">
          {{node.name}}

          <mat-form-field>
            <label>
              <input matInput placeholder="e.g. '10'" type="number" [(ngModel)]="achievementReq.count" name="count">
            </label>

          </mat-form-field>

        </div>
      </li>
    </mat-tree-node>

    <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild">
      <li>
        <div class="mat-tree-node">
          <button mat-icon-button matTreeNodeToggle
                  [attr.aria-label]="'toggle ' + node.name">
            <mat-icon class="mat-icon-rtl-mirror">
              {{customTreeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
            </mat-icon>
          </button>
          {{node.name}}
        </div>
        <ul [class.invisible]="!customTreeControl.isExpanded(node)">
          <ng-container matTreeNodeOutlet></ng-container>
        </ul>
      </li>
    </mat-nested-tree-node>

  </mat-tree>

  <div>
    <label>
      Name
      <br>
      <mat-form-field>
        <input matInput placeholder="e.g. 'Professional book reviewer'" type="text"
               [(ngModel)]="this.achievementReq.name" name="name">
      </mat-form-field>
      <br>
    </label>
  </div>

  <!-- Pages -->
  <ng-container *ngIf="chosenSubject==='books'">
    <label>
      Pages:
      <br>
      <br>
      <mat-form-field>
        <input matInput placeholder="from, e.g. '100'" type="number">
      </mat-form-field>
      <br>
      <mat-form-field>
        <input matInput placeholder="to, e.g. '430'" type="number">
      </mat-form-field>
    </label>
  </ng-container>

  <br>

  <!-- Release date -->
  <ng-container *ngIf="chosenSubject==='books'">
    <label>
      Release date:
      <br>
      <br>
      <mat-form-field>
        <input matInput placeholder="from" type="date" [(ngModel)]="chosenDate.from">
      </mat-form-field>
      <br>
      <mat-form-field>
        <input matInput placeholder="to" type="date" [(ngModel)]="chosenDate.to">
      </mat-form-field>
    </label>
  </ng-container>

  <!-- Voters count -->
  <br>
  <ng-container *ngIf="chosenSubject==='books'">
    <label>
      Voters count:
      <br>
      <br>
      <mat-form-field>
        <input matInput placeholder="from" type="number" [(ngModel)]="votersCount.from">
      </mat-form-field>
      <br>
      <mat-form-field>
        <input matInput placeholder="to" type="number" [(ngModel)]="votersCount.to">
      </mat-form-field>
    </label>
  </ng-container>

  <!--  Genres with paginator-->
  <ng-container *ngIf="chosenVerb==='books'">
    <div class="genres-container"
         *ngIf="genreDataSource.data && genreDataSource.data[0] && genreDataSource.data[0].children">
      <div *ngFor="let el of genreDataSource.data[0].children | slice:startIndex :endIndex">
        <div class="achievement-row">
          <mat-checkbox class="mat-checkbox" (click)="addGenre(el.name)" name="genreParams">
            {{el.name}}
          </mat-checkbox>
        </div>
        <mat-divider></mat-divider>
      </div>
      <mat-paginator class="paginator" [length]="genreDataSource.data[0].children.length" [pageSize]="pageSize"
                     (page)="getPaginatorData($event)">
      </mat-paginator>
    </div>
  </ng-container>

  <button (click)="createAchievement()">Create new achievement</button>
</div>




